2025-05-06 19:29:25,827 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-06 19:29:25,828 - INFO - Created all necessary directories
2025-05-06 19:29:25,828 - INFO - Loading data...
2025-05-06 19:29:25,828 - INFO - Loading and merging data...
2025-05-06 19:29:25,927 - INFO - Loaded price data: (73007, 11)
2025-05-06 19:29:25,928 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:29:26,035 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:29:26,041 - INFO - Merged grid data: (73007, 21)
2025-05-06 19:29:26,366 - INFO - Merged time features: (73007, 31)
2025-05-06 19:29:26,984 - INFO - Merged holiday data: (73007, 35)
2025-05-06 19:29:27,151 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:29:27,169 - INFO - Merged weather data: (73007, 41)
2025-05-06 19:29:27,177 - INFO - No missing values in merged dataframe - all data ranges properly aligned
2025-05-06 19:29:27,186 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 19:29:27,186 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:29:27,205 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-06 19:29:27,206 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-06 19:29:27,206 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:29:27,206 - INFO - === Starting peak model training (TCN) ===
2025-05-06 19:29:27,207 - INFO - Preparing data for is_price_peak model training...
2025-05-06 19:29:27,207 - INFO - Loading and merging data...
2025-05-06 19:29:27,306 - INFO - Loaded price data: (73007, 11)
2025-05-06 19:29:27,306 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:29:27,400 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:29:27,406 - INFO - Merged grid data: (73007, 21)
2025-05-06 19:29:27,698 - INFO - Merged time features: (73007, 31)
2025-05-06 19:29:28,193 - INFO - Merged holiday data: (73007, 35)
2025-05-06 19:29:28,308 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:29:28,325 - INFO - Merged weather data: (73007, 41)
2025-05-06 19:29:28,333 - INFO - No missing values in merged dataframe - all data ranges properly aligned
2025-05-06 19:29:28,339 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 19:29:28,339 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:29:28,343 - INFO - Adding lag features for trend detection...
2025-05-06 19:29:28,389 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-06 19:29:28,414 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-06 19:29:55,472 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 19:29:55,473 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 19:29:55,486 - INFO - Using robust peak detection algorithm
2025-05-06 19:29:58,542 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 19:29:58,545 - INFO - Using new robust valley detection algorithm
2025-05-06 19:30:01,647 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 19:30:01,652 - INFO - Detected 14836 peaks (20.3% of data) and 14059 valleys (19.3% of data)
2025-05-06 19:30:01,655 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-06 19:30:01,655 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-06 19:30:01,657 - INFO - Using peak-specific features for model training
2025-05-06 19:30:01,658 - INFO - Using 24 features for is_price_peak detection
2025-05-06 19:30:01,672 - INFO - Data split: Train (51104, 24), Validation (10951, 24), Test (10952, 24)
2025-05-06 19:30:01,673 - INFO - Target distribution in train: 20.59% positive samples
2025-05-06 19:30:01,673 - INFO - Target distribution in val: 19.61% positive samples
2025-05-06 19:30:01,673 - INFO - Target distribution in test: 19.80% positive samples
2025-05-06 19:30:02,426 - INFO - Sequence shapes: X_train (50913, 168, 23), y_train (50913, 1)
2025-05-06 19:30:02,427 - INFO - Training peak detection model...
2025-05-06 19:30:02,429 - INFO - Saved feature list with 23 features
2025-05-06 19:30:02,430 - INFO - Saved feature scaler
2025-05-06 19:30:02,431 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'robust', 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-06 19:30:03,286 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-06 19:30:03,471 - INFO - Built peak model with input shape (168, 23)
2025-05-06 19:30:03,471 - INFO - Class weights: {0: 1, 1: 3.8534795042897994}
2025-05-06 19:30:03,482 - INFO - Training with validation data (shape: (10760, 168, 23))
2025-05-06 19:41:33,925 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-06 19:41:33,926 - INFO - Created all necessary directories
2025-05-06 19:41:33,927 - INFO - Loading data...
2025-05-06 19:41:33,927 - INFO - Loading and merging data...
2025-05-06 19:41:34,017 - INFO - Loaded price data: (73007, 11)
2025-05-06 19:41:34,018 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:41:34,118 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:41:34,125 - INFO - Merged grid data: (73007, 21)
2025-05-06 19:41:34,431 - INFO - Merged time features: (73007, 31)
2025-05-06 19:41:34,932 - INFO - Merged holiday data: (73007, 35)
2025-05-06 19:41:35,047 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:41:35,061 - INFO - Merged weather data: (73007, 41)
2025-05-06 19:41:35,069 - INFO - No missing values in merged dataframe - all data ranges properly aligned
2025-05-06 19:41:35,077 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 19:41:35,077 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:41:35,091 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-06 19:41:35,091 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-06 19:41:35,091 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:41:35,092 - INFO - === Starting peak model training (TCN) ===
2025-05-06 19:41:35,092 - INFO - Preparing data for is_price_peak model training...
2025-05-06 19:41:35,092 - INFO - Loading and merging data...
2025-05-06 19:41:35,185 - INFO - Loaded price data: (73007, 11)
2025-05-06 19:41:35,186 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:41:35,284 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:41:35,290 - INFO - Merged grid data: (73007, 21)
2025-05-06 19:41:35,589 - INFO - Merged time features: (73007, 31)
2025-05-06 19:41:36,081 - INFO - Merged holiday data: (73007, 35)
2025-05-06 19:41:36,207 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:41:36,223 - INFO - Merged weather data: (73007, 41)
2025-05-06 19:41:36,231 - INFO - No missing values in merged dataframe - all data ranges properly aligned
2025-05-06 19:41:36,237 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 19:41:36,237 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:41:36,240 - INFO - Adding lag features for trend detection...
2025-05-06 19:41:36,290 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-06 19:41:36,315 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-06 19:42:04,782 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 19:42:04,782 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 19:42:04,797 - INFO - Using robust peak detection algorithm
2025-05-06 19:42:08,050 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 19:42:08,054 - INFO - Using new robust valley detection algorithm
2025-05-06 19:42:11,172 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 19:42:11,178 - INFO - Detected 14836 peaks (20.3% of data) and 14059 valleys (19.3% of data)
2025-05-06 19:42:11,180 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-06 19:42:11,180 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-06 19:42:11,183 - INFO - Using peak-specific features for model training
2025-05-06 19:42:11,183 - INFO - Using 24 features for is_price_peak detection
2025-05-06 19:42:11,198 - INFO - Data split: Train (51104, 24), Validation (10951, 24), Test (10952, 24)
2025-05-06 19:42:11,198 - INFO - Target distribution in train: 20.59% positive samples
2025-05-06 19:42:11,198 - INFO - Target distribution in val: 19.61% positive samples
2025-05-06 19:42:11,199 - INFO - Target distribution in test: 19.80% positive samples
2025-05-06 19:42:11,794 - INFO - Sequence shapes: X_train (50913, 168, 23), y_train (50913, 1)
2025-05-06 19:42:11,795 - INFO - Training peak detection model...
2025-05-06 19:42:11,797 - INFO - Saved feature list with 23 features
2025-05-06 19:42:11,798 - INFO - Saved feature scaler
2025-05-06 19:42:11,799 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'robust', 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-06 19:42:12,874 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-06 19:42:13,112 - INFO - Built peak model with input shape (168, 23)
2025-05-06 19:42:13,113 - INFO - Class weights: {0: 1, 1: 3.8534795042897994}
2025-05-06 19:42:13,127 - INFO - Training with validation data (shape: (10760, 168, 23))
2025-05-06 19:42:38,320 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-06 19:42:38,321 - INFO - Created all necessary directories
2025-05-06 19:42:38,321 - INFO - Loading data...
2025-05-06 19:42:38,321 - INFO - Loading and merging data...
2025-05-06 19:42:38,413 - INFO - Loaded price data: (73007, 11)
2025-05-06 19:42:38,414 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:42:38,513 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:42:38,519 - INFO - Merged grid data: (73007, 21)
2025-05-06 19:42:38,813 - INFO - Merged time features: (73007, 31)
2025-05-06 19:42:39,325 - INFO - Merged holiday data: (73007, 35)
2025-05-06 19:42:39,446 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:42:39,458 - INFO - Merged weather data: (73007, 41)
2025-05-06 19:42:39,467 - INFO - No missing values in merged dataframe - all data ranges properly aligned
2025-05-06 19:42:39,474 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 19:42:39,475 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:42:39,490 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-06 19:42:39,490 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-06 19:42:39,490 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:42:39,491 - INFO - === Starting peak model training (TCN) ===
2025-05-06 19:42:39,491 - INFO - Preparing data for is_price_peak model training...
2025-05-06 19:42:39,491 - INFO - Loading and merging data...
2025-05-06 19:42:39,580 - INFO - Loaded price data: (73007, 11)
2025-05-06 19:42:39,581 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:42:39,709 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:42:39,719 - INFO - Merged grid data: (73007, 21)
2025-05-06 19:42:40,033 - INFO - Merged time features: (73007, 31)
2025-05-06 19:42:40,540 - INFO - Merged holiday data: (73007, 35)
2025-05-06 19:42:40,660 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:42:40,674 - INFO - Merged weather data: (73007, 41)
2025-05-06 19:42:40,683 - INFO - No missing values in merged dataframe - all data ranges properly aligned
2025-05-06 19:42:40,689 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 19:42:40,690 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:42:40,693 - INFO - Adding lag features for trend detection...
2025-05-06 19:42:40,742 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-06 19:42:40,767 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-06 19:43:09,657 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 19:43:09,657 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 19:43:09,670 - INFO - Using robust peak detection algorithm
2025-05-06 19:43:13,301 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 19:43:13,304 - INFO - Using new robust valley detection algorithm
2025-05-06 19:43:16,697 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 19:43:16,702 - INFO - Detected 14836 peaks (20.3% of data) and 14059 valleys (19.3% of data)
2025-05-06 19:43:16,703 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-06 19:43:16,704 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-06 19:43:16,705 - INFO - Using peak-specific features for model training
2025-05-06 19:43:16,706 - INFO - Using 24 features for is_price_peak detection
2025-05-06 19:43:16,721 - INFO - Data split: Train (51104, 24), Validation (10951, 24), Test (10952, 24)
2025-05-06 19:43:16,721 - INFO - Target distribution in train: 20.59% positive samples
2025-05-06 19:43:16,722 - INFO - Target distribution in val: 19.61% positive samples
2025-05-06 19:43:16,722 - INFO - Target distribution in test: 19.80% positive samples
2025-05-06 19:43:17,287 - INFO - Sequence shapes: X_train (50913, 168, 23), y_train (50913, 1)
2025-05-06 19:43:17,289 - INFO - Training peak detection model...
2025-05-06 19:43:17,290 - INFO - Saved feature list with 23 features
2025-05-06 19:43:17,291 - INFO - Saved feature scaler
2025-05-06 19:43:17,291 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'robust', 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-06 19:43:18,419 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-06 19:43:18,653 - INFO - Built peak model with input shape (168, 23)
2025-05-06 19:43:18,653 - INFO - Class weights: {0: 1, 1: 3.8534795042897994}
2025-05-06 19:43:18,671 - INFO - Training with validation data (shape: (10760, 168, 23))
2025-05-06 19:49:15,147 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-06 19:49:15,148 - INFO - Created all necessary directories
2025-05-06 19:49:15,148 - INFO - Loading data...
2025-05-06 19:49:15,148 - INFO - Loading and merging data...
2025-05-06 19:49:15,240 - INFO - Loaded price data: (73007, 11)
2025-05-06 19:49:15,240 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:49:15,344 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:49:15,351 - INFO - Merged grid data: (73007, 21)
2025-05-06 19:49:15,657 - INFO - Merged time features: (73007, 31)
2025-05-06 19:49:16,147 - INFO - Merged holiday data: (73007, 35)
2025-05-06 19:49:16,263 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:49:16,276 - INFO - Merged weather data: (73007, 41)
2025-05-06 19:49:16,285 - INFO - No missing values in merged dataframe - all data ranges properly aligned
2025-05-06 19:49:16,291 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 19:49:16,292 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:49:16,308 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-06 19:49:16,309 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-06 19:49:16,309 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:49:16,309 - INFO - === Starting peak model training (TCN) ===
2025-05-06 19:49:16,310 - INFO - Preparing data for is_price_peak model training...
2025-05-06 19:49:16,310 - INFO - Loading and merging data...
2025-05-06 19:49:16,393 - INFO - Loaded price data: (73007, 11)
2025-05-06 19:49:16,393 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:49:16,499 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:49:16,506 - INFO - Merged grid data: (73007, 21)
2025-05-06 19:49:16,791 - INFO - Merged time features: (73007, 31)
2025-05-06 19:49:17,298 - INFO - Merged holiday data: (73007, 35)
2025-05-06 19:49:17,418 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:49:17,430 - INFO - Merged weather data: (73007, 41)
2025-05-06 19:49:17,437 - INFO - No missing values in merged dataframe - all data ranges properly aligned
2025-05-06 19:49:17,443 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 19:49:17,443 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:49:17,447 - INFO - Adding lag features for trend detection...
2025-05-06 19:49:17,500 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-06 19:49:17,525 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-06 19:49:45,419 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 19:49:45,420 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 19:49:45,435 - INFO - Using robust peak detection algorithm
2025-05-06 19:49:48,534 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 19:49:48,539 - INFO - Using new robust valley detection algorithm
2025-05-06 19:49:51,609 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 19:49:51,614 - INFO - Detected 14836 peaks (20.3% of data) and 14059 valleys (19.3% of data)
2025-05-06 19:49:51,616 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-06 19:49:51,616 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-06 19:49:51,619 - INFO - Using peak-specific features for model training
2025-05-06 19:49:51,619 - INFO - Using 24 features for is_price_peak detection
2025-05-06 19:49:51,637 - INFO - Data split: Train (51104, 24), Validation (10951, 24), Test (10952, 24)
2025-05-06 19:49:51,637 - INFO - Target distribution in train: 20.59% positive samples
2025-05-06 19:49:51,638 - INFO - Target distribution in val: 19.61% positive samples
2025-05-06 19:49:51,638 - INFO - Target distribution in test: 19.80% positive samples
2025-05-06 19:49:52,136 - INFO - Sequence shapes: X_train (50913, 168, 23), y_train (50913, 1)
2025-05-06 19:49:52,138 - INFO - Training peak detection model...
2025-05-06 19:49:52,138 - INFO - Generating peak label validation plots...
2025-05-06 19:49:52,139 - ERROR - Error in training process: DataFrame must include 'SE3_price_ore' and 'is_price_peak_robust' columns
2025-05-06 19:49:52,139 - ERROR - Traceback (most recent call last):
  File "c:\_Projects\home-energy-ai\src\predictions\prices\train.py", line 2265, in main
    model, history = train_peak_valley_model(peak_data, 'peak', production_mode=production_mode)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\_Projects\home-energy-ai\src\predictions\prices\train.py", line 1640, in train_peak_valley_model
    plot_peak_labels(data['df'], output_dir=validation_plots_dir, num_samples=5, days_per_sample=14)
  File "c:\_Projects\home-energy-ai\src\predictions\prices\train.py", line 441, in plot_peak_labels
    raise ValueError(f"DataFrame must include '{TARGET_VARIABLE}' and 'is_price_peak_robust' columns")
ValueError: DataFrame must include 'SE3_price_ore' and 'is_price_peak_robust' columns

2025-05-06 19:54:46,691 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-06 19:54:46,692 - INFO - Created all necessary directories
2025-05-06 19:54:46,692 - INFO - Loading data...
2025-05-06 19:54:46,692 - INFO - Loading and merging data...
2025-05-06 19:54:46,802 - INFO - Loaded price data: (73007, 11)
2025-05-06 19:54:46,803 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:54:46,919 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:54:46,925 - INFO - Merged grid data: (73007, 21)
2025-05-06 19:54:47,248 - INFO - Merged time features: (73007, 31)
2025-05-06 19:54:47,762 - INFO - Merged holiday data: (73007, 35)
2025-05-06 19:54:47,891 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:54:47,906 - INFO - Merged weather data: (73007, 41)
2025-05-06 19:54:47,913 - INFO - No missing values in merged dataframe - all data ranges properly aligned
2025-05-06 19:54:47,919 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 19:54:47,920 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:54:47,937 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-06 19:54:47,938 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-06 19:54:47,938 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:54:47,938 - INFO - === Starting peak model training (TCN) ===
2025-05-06 19:54:47,939 - INFO - Preparing data for is_price_peak model training...
2025-05-06 19:54:47,939 - INFO - Loading and merging data...
2025-05-06 19:54:48,031 - INFO - Loaded price data: (73007, 11)
2025-05-06 19:54:48,032 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:54:48,148 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:54:48,157 - INFO - Merged grid data: (73007, 21)
2025-05-06 19:54:48,490 - INFO - Merged time features: (73007, 31)
2025-05-06 19:54:49,021 - INFO - Merged holiday data: (73007, 35)
2025-05-06 19:54:49,148 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:54:49,163 - INFO - Merged weather data: (73007, 41)
2025-05-06 19:54:49,171 - INFO - No missing values in merged dataframe - all data ranges properly aligned
2025-05-06 19:54:49,179 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 19:54:49,179 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 19:54:49,183 - INFO - Adding lag features for trend detection...
2025-05-06 19:54:49,242 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-06 19:54:49,272 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-06 19:55:20,208 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 19:55:20,208 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 19:55:20,226 - INFO - Using robust peak detection algorithm
2025-05-06 19:55:23,837 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 19:55:23,841 - INFO - Using new robust valley detection algorithm
2025-05-06 19:55:27,216 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 19:55:27,221 - INFO - Detected 14836 peaks (20.3% of data) and 14059 valleys (19.3% of data)
2025-05-06 19:55:27,223 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-06 19:55:27,223 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-06 19:55:27,226 - INFO - Using peak-specific features for model training
2025-05-06 19:55:27,227 - INFO - Using 24 features for is_price_peak detection
2025-05-06 19:55:27,241 - INFO - Data split: Train (51104, 24), Validation (10951, 24), Test (10952, 24)
2025-05-06 19:55:27,242 - INFO - Target distribution in train: 20.59% positive samples
2025-05-06 19:55:27,242 - INFO - Target distribution in val: 19.61% positive samples
2025-05-06 19:55:27,242 - INFO - Target distribution in test: 19.80% positive samples
2025-05-06 19:55:27,772 - INFO - Sequence shapes: X_train (50913, 168, 23), y_train (50913, 1)
2025-05-06 19:55:27,774 - INFO - Training peak detection model...
2025-05-06 19:55:27,774 - INFO - Generating peak label validation plots...
2025-05-06 19:55:31,569 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 19:55:37,090 - INFO - Peak detection validation plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_validation
2025-05-06 19:55:37,091 - INFO - Saved feature list with 23 features
2025-05-06 19:55:37,092 - INFO - Saved feature scaler
2025-05-06 19:55:37,092 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'robust', 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-06 19:55:38,098 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-06 19:55:38,616 - INFO - Built peak model with input shape (168, 23)
2025-05-06 19:55:38,617 - INFO - Class weights: {0: 1, 1: 3.8534795042897994}
2025-05-06 19:55:38,632 - INFO - Training with validation data (shape: (10760, 168, 23))
2025-05-06 20:08:48,239 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-06 20:08:48,240 - INFO - Created all necessary directories
2025-05-06 20:08:48,240 - INFO - Loading data...
2025-05-06 20:08:48,241 - INFO - Loading and merging data...
2025-05-06 20:08:48,381 - INFO - Loaded price data: (73007, 11)
2025-05-06 20:08:48,382 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:08:48,518 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:08:48,525 - INFO - Merged grid data: (73007, 21)
2025-05-06 20:08:48,816 - INFO - Merged time features: (73007, 31)
2025-05-06 20:08:49,292 - INFO - Merged holiday data: (73007, 35)
2025-05-06 20:08:49,405 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:08:49,417 - INFO - Merged weather data: (73007, 41)
2025-05-06 20:08:49,425 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-06 20:08:49,429 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-06 20:08:49,612 - WARNING - Top gaps in 'price_24h_std':
2025-05-06 20:08:49,612 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-06 20:08:49,612 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-06 20:08:49,612 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-06 20:08:49,612 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-06 20:08:49,613 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-06 20:08:49,613 - WARNING -   ... and 73001 more gaps
2025-05-06 20:08:49,616 - WARNING -   Median gap size: 0.0 hours
2025-05-06 20:08:49,618 - WARNING -   Average gap size: 0.0 hours
2025-05-06 20:08:49,620 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-06 20:08:49,622 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 20:08:49,622 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:08:49,642 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-06 20:08:49,643 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-06 20:08:49,643 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:08:49,643 - INFO - === Starting peak model training (TCN) ===
2025-05-06 20:08:49,644 - INFO - Preparing data for is_price_peak model training...
2025-05-06 20:08:49,644 - INFO - Loading and merging data...
2025-05-06 20:08:49,754 - INFO - Loaded price data: (73007, 11)
2025-05-06 20:08:49,755 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:08:49,852 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:08:49,859 - INFO - Merged grid data: (73007, 21)
2025-05-06 20:08:50,142 - INFO - Merged time features: (73007, 31)
2025-05-06 20:08:50,606 - INFO - Merged holiday data: (73007, 35)
2025-05-06 20:08:50,721 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:08:50,735 - INFO - Merged weather data: (73007, 41)
2025-05-06 20:08:50,742 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-06 20:08:50,746 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-06 20:08:50,922 - WARNING - Top gaps in 'price_24h_std':
2025-05-06 20:08:50,923 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-06 20:08:50,923 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-06 20:08:50,923 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-06 20:08:50,923 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-06 20:08:50,923 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-06 20:08:50,924 - WARNING -   ... and 73001 more gaps
2025-05-06 20:08:50,927 - WARNING -   Median gap size: 0.0 hours
2025-05-06 20:08:50,929 - WARNING -   Average gap size: 0.0 hours
2025-05-06 20:08:50,930 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-06 20:08:50,933 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 20:08:50,933 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:08:50,942 - INFO - Adding lag features for trend detection...
2025-05-06 20:08:50,988 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-06 20:08:51,011 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-06 20:09:18,730 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 20:09:18,731 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 20:09:18,743 - INFO - Using robust peak detection algorithm
2025-05-06 20:09:21,752 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 20:09:21,756 - INFO - Using new robust valley detection algorithm
2025-05-06 20:09:24,709 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 20:09:24,713 - INFO - Detected 14836 peaks (20.3% of data) and 14059 valleys (19.3% of data)
2025-05-06 20:09:24,714 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-06 20:09:24,714 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-06 20:09:24,716 - INFO - Using peak-specific features for model training
2025-05-06 20:09:24,717 - INFO - Using 24 features for is_price_peak detection
2025-05-06 20:09:24,732 - INFO - Data split: Train (51104, 24), Validation (10951, 24), Test (10952, 24)
2025-05-06 20:09:24,732 - INFO - Target distribution in train: 20.59% positive samples
2025-05-06 20:09:24,732 - INFO - Target distribution in val: 19.61% positive samples
2025-05-06 20:09:24,733 - INFO - Target distribution in test: 19.80% positive samples
2025-05-06 20:09:25,199 - INFO - Sequence shapes: X_train (50913, 168, 23), y_train (50913, 1)
2025-05-06 20:09:25,200 - INFO - Training peak detection model...
2025-05-06 20:09:25,201 - INFO - Generating peak label validation plots...
2025-05-06 20:09:28,113 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 20:09:32,761 - INFO - Peak detection validation plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_validation
2025-05-06 20:09:32,761 - INFO - Generating peak detection method comparison plots...
2025-05-06 20:09:32,765 - INFO - Applying different peak detection methods for comparison...
2025-05-06 20:09:32,767 - INFO - Traditional threshold method: 7301 peaks (10.0% of data)
2025-05-06 20:10:00,197 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 20:10:00,197 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 20:10:00,202 - INFO - Relative detection method: 398 peaks (0.5% of data)
2025-05-06 20:10:03,290 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 20:10:03,292 - INFO - Robust detection method: 14836 peaks (20.3% of data)
2025-05-06 20:10:03,296 - INFO - Simple scipy method: 1945 peaks (2.7% of data)
2025-05-06 20:10:03,607 - INFO - Local maxima method: 2502 peaks (3.4% of data)
2025-05-06 20:10:06,637 - INFO - Peak detection method comparison plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_method_comparison
2025-05-06 20:10:06,638 - INFO - Saved feature list with 23 features
2025-05-06 20:10:06,639 - INFO - Saved feature scaler
2025-05-06 20:10:06,639 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'robust', 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-06 20:10:07,446 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-06 20:10:07,618 - INFO - Built peak model with input shape (168, 23)
2025-05-06 20:10:07,618 - INFO - Class weights: {0: 1, 1: 3.8534795042897994}
2025-05-06 20:10:07,630 - INFO - Training with validation data (shape: (10760, 168, 23))
2025-05-06 20:59:03,871 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-06 20:59:03,873 - INFO - Created all necessary directories
2025-05-06 20:59:03,873 - INFO - Loading data...
2025-05-06 20:59:03,873 - INFO - Loading and merging data...
2025-05-06 20:59:03,995 - INFO - Loaded price data: (73007, 11)
2025-05-06 20:59:03,995 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:59:04,105 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:59:04,115 - INFO - Merged grid data: (73007, 21)
2025-05-06 20:59:04,431 - INFO - Merged time features: (73007, 31)
2025-05-06 20:59:04,941 - INFO - Merged holiday data: (73007, 35)
2025-05-06 20:59:05,057 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:59:05,073 - INFO - Merged weather data: (73007, 41)
2025-05-06 20:59:05,080 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-06 20:59:05,084 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-06 20:59:05,266 - WARNING - Top gaps in 'price_24h_std':
2025-05-06 20:59:05,266 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-06 20:59:05,266 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-06 20:59:05,266 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-06 20:59:05,266 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-06 20:59:05,266 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-06 20:59:05,266 - WARNING -   ... and 73001 more gaps
2025-05-06 20:59:05,269 - WARNING -   Median gap size: 0.0 hours
2025-05-06 20:59:05,272 - WARNING -   Average gap size: 0.0 hours
2025-05-06 20:59:05,273 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-06 20:59:05,276 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 20:59:05,276 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:59:05,296 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-06 20:59:05,296 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-06 20:59:05,296 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:59:05,297 - INFO - === Starting peak model training (TCN) ===
2025-05-06 20:59:05,297 - INFO - Preparing data for is_price_peak model training...
2025-05-06 20:59:05,297 - INFO - Loading and merging data...
2025-05-06 20:59:05,428 - INFO - Loaded price data: (73007, 11)
2025-05-06 20:59:05,429 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:59:05,527 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:59:05,536 - INFO - Merged grid data: (73007, 21)
2025-05-06 20:59:05,831 - INFO - Merged time features: (73007, 31)
2025-05-06 20:59:06,333 - INFO - Merged holiday data: (73007, 35)
2025-05-06 20:59:06,468 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:59:06,481 - INFO - Merged weather data: (73007, 41)
2025-05-06 20:59:06,488 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-06 20:59:06,492 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-06 20:59:06,673 - WARNING - Top gaps in 'price_24h_std':
2025-05-06 20:59:06,674 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-06 20:59:06,674 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-06 20:59:06,674 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-06 20:59:06,674 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-06 20:59:06,674 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-06 20:59:06,674 - WARNING -   ... and 73001 more gaps
2025-05-06 20:59:06,676 - WARNING -   Median gap size: 0.0 hours
2025-05-06 20:59:06,680 - WARNING -   Average gap size: 0.0 hours
2025-05-06 20:59:06,680 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-06 20:59:06,683 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 20:59:06,683 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 20:59:06,691 - INFO - Adding lag features for trend detection...
2025-05-06 20:59:06,739 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-06 20:59:06,761 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-06 20:59:34,822 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 20:59:34,823 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 20:59:34,833 - INFO - Using robust peak detection algorithm for comparison
2025-05-06 20:59:37,901 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 20:59:37,904 - INFO - Using new robust valley detection algorithm
2025-05-06 20:59:40,871 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 20:59:40,873 - INFO - Using Scipy method for peak detection
2025-05-06 20:59:40,877 - INFO - Detected 1805 peaks (2.5% of data) and 14059 valleys (19.3% of data)
2025-05-06 20:59:40,879 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-06 20:59:40,879 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-06 20:59:40,881 - INFO - Using peak-specific features for model training
2025-05-06 20:59:40,881 - INFO - Using 24 features for is_price_peak detection
2025-05-06 20:59:40,894 - INFO - Data split: Train (51104, 24), Validation (10951, 24), Test (10952, 24)
2025-05-06 20:59:40,895 - INFO - Target distribution in train: 1.98% positive samples
2025-05-06 20:59:40,895 - INFO - Target distribution in val: 3.86% positive samples
2025-05-06 20:59:40,895 - INFO - Target distribution in test: 3.37% positive samples
2025-05-06 20:59:41,440 - INFO - Sequence shapes: X_train (50913, 168, 23), y_train (50913, 1)
2025-05-06 20:59:41,441 - INFO - Training peak detection model...
2025-05-06 20:59:41,442 - INFO - Generating peak label validation plots...
2025-05-06 20:59:44,358 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 20:59:50,738 - INFO - Peak detection validation plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_validation
2025-05-06 20:59:50,738 - INFO - Generating peak detection method comparison plots...
2025-05-06 20:59:50,742 - INFO - Applying different peak detection methods for comparison...
2025-05-06 20:59:50,744 - INFO - Traditional threshold method: 7301 peaks (10.0% of data)
2025-05-06 21:00:18,579 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 21:00:18,579 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 21:00:18,585 - INFO - Relative detection method: 398 peaks (0.5% of data)
2025-05-06 21:00:21,608 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 21:00:21,610 - INFO - Robust detection method: 14836 peaks (20.3% of data)
2025-05-06 21:00:21,613 - INFO - Simple scipy method: 1945 peaks (2.7% of data)
2025-05-06 21:00:21,925 - INFO - Local maxima method: 2502 peaks (3.4% of data)
2025-05-06 21:00:24,933 - INFO - Peak detection method comparison plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_method_comparison
2025-05-06 21:00:24,933 - INFO - Saved feature list with 23 features
2025-05-06 21:00:24,935 - INFO - Saved feature scaler
2025-05-06 21:00:24,936 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'scipy', 'peak_prominence': 27.805590000000002, 'peak_distance': 4, 'peak_width': 2, 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-06 21:00:25,863 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-06 21:00:26,056 - INFO - Built peak model with input shape (168, 23)
2025-05-06 21:00:26,056 - INFO - Class weights: {0: 1, 1: 49.359050445103854}
2025-05-06 21:00:26,067 - INFO - Training with validation data (shape: (10760, 168, 23))
2025-05-06 21:58:13,989 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-06 21:58:14,004 - INFO - Created all necessary directories
2025-05-06 21:58:14,004 - INFO - Loading data...
2025-05-06 21:58:14,004 - INFO - Loading and merging data...
2025-05-06 21:58:14,556 - INFO - Loaded price data: (73007, 11)
2025-05-06 21:58:14,557 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 21:58:14,947 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 21:58:14,971 - INFO - Merged grid data: (73007, 21)
2025-05-06 21:58:15,894 - INFO - Merged time features: (73007, 31)
2025-05-06 21:58:17,611 - INFO - Merged holiday data: (73007, 35)
2025-05-06 21:58:17,967 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 21:58:18,009 - INFO - Merged weather data: (73007, 41)
2025-05-06 21:58:18,028 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-06 21:58:18,032 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-06 21:58:18,667 - WARNING - Top gaps in 'price_24h_std':
2025-05-06 21:58:18,670 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-06 21:58:18,671 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-06 21:58:18,672 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-06 21:58:18,672 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-06 21:58:18,672 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-06 21:58:18,672 - WARNING -   ... and 73001 more gaps
2025-05-06 21:58:18,675 - WARNING -   Median gap size: 0.0 hours
2025-05-06 21:58:18,681 - WARNING -   Average gap size: 0.0 hours
2025-05-06 21:58:18,685 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-06 21:58:18,690 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 21:58:18,691 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 21:58:18,759 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-06 21:58:18,764 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-06 21:58:18,764 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 21:58:18,765 - INFO - === Starting peak model training (TCN) ===
2025-05-06 21:58:18,766 - INFO - Preparing data for is_price_peak model training...
2025-05-06 21:58:18,766 - INFO - Loading and merging data...
2025-05-06 21:58:19,233 - INFO - Loaded price data: (73007, 11)
2025-05-06 21:58:19,236 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 21:58:19,629 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 21:58:19,666 - INFO - Merged grid data: (73007, 21)
2025-05-06 21:58:20,783 - INFO - Merged time features: (73007, 31)
2025-05-06 21:58:22,673 - INFO - Merged holiday data: (73007, 35)
2025-05-06 21:58:23,092 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 21:58:23,132 - INFO - Merged weather data: (73007, 41)
2025-05-06 21:58:23,144 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-06 21:58:23,157 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-06 21:58:23,779 - WARNING - Top gaps in 'price_24h_std':
2025-05-06 21:58:23,779 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-06 21:58:23,779 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-06 21:58:23,780 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-06 21:58:23,780 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-06 21:58:23,780 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-06 21:58:23,780 - WARNING -   ... and 73001 more gaps
2025-05-06 21:58:23,783 - WARNING -   Median gap size: 0.0 hours
2025-05-06 21:58:23,794 - WARNING -   Average gap size: 0.0 hours
2025-05-06 21:58:23,797 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-06 21:58:23,802 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 21:58:23,802 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 21:58:23,818 - INFO - Adding lag features for trend detection...
2025-05-06 21:58:23,930 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-06 21:58:23,989 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-06 21:59:43,102 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 21:59:43,103 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 21:59:43,126 - INFO - Using robust peak detection algorithm for comparison
2025-05-06 21:59:49,543 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 21:59:49,549 - INFO - Using new robust valley detection algorithm
2025-05-06 21:59:59,797 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 21:59:59,802 - INFO - Using Scipy method for peak detection
2025-05-06 21:59:59,814 - INFO - Detected 1805 peaks (2.5% of data) and 14059 valleys (19.3% of data)
2025-05-06 21:59:59,816 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-06 21:59:59,817 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-06 21:59:59,820 - INFO - Using peak-specific features for model training
2025-05-06 21:59:59,823 - INFO - Using 24 features for is_price_peak detection
2025-05-06 21:59:59,869 - INFO - Data split: Train (51104, 24), Validation (10951, 24), Test (10952, 24)
2025-05-06 21:59:59,870 - INFO - Target distribution in train: 1.98% positive samples
2025-05-06 21:59:59,871 - INFO - Target distribution in val: 3.86% positive samples
2025-05-06 21:59:59,872 - INFO - Target distribution in test: 3.37% positive samples
2025-05-06 22:00:01,620 - INFO - Sequence shapes: X_train (50913, 168, 23), y_train (50913, 1)
2025-05-06 22:00:01,623 - INFO - Training peak detection model...
2025-05-06 22:00:01,625 - INFO - Generating peak label validation plots...
2025-05-06 22:00:17,234 - INFO - Peak detection validation plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_validation
2025-05-06 22:00:17,234 - INFO - Generating peak detection method comparison plots...
2025-05-06 22:00:17,244 - INFO - Applying different peak detection methods for comparison...
2025-05-06 22:00:17,249 - INFO - Traditional threshold method: 7301 peaks (10.0% of data)
2025-05-06 22:01:47,210 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 22:01:47,210 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 22:01:47,248 - INFO - Relative detection method: 398 peaks (0.5% of data)
2025-05-06 22:01:59,900 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 22:01:59,902 - INFO - Robust detection method: 14836 peaks (20.3% of data)
2025-05-06 22:01:59,928 - INFO - Simple scipy method: 1945 peaks (2.7% of data)
2025-05-06 22:02:00,926 - INFO - Local maxima method: 2502 peaks (3.4% of data)
2025-05-06 22:02:06,880 - INFO - Peak detection method comparison plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_method_comparison
2025-05-06 22:02:06,880 - INFO - Saved feature list with 23 features
2025-05-06 22:02:06,881 - INFO - Saved feature scaler
2025-05-06 22:02:06,882 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'scipy', 'peak_prominence': 27.805590000000002, 'peak_distance': 4, 'peak_width': 2, 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-06 22:02:08,461 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-06 22:02:09,663 - INFO - Built peak model with input shape (168, 23)
2025-05-06 22:02:09,665 - INFO - Class weights: {0: 1, 1: 49.359050445103854}
2025-05-06 22:02:09,710 - INFO - Training with validation data (shape: (10760, 168, 23))
2025-05-06 22:04:30,895 - INFO - Training completed. Best validation loss 0.3939 at epoch 14
2025-05-06 22:04:31,119 - INFO - Saved model to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\final_peak_model.keras
2025-05-06 22:04:35,711 - INFO - Validation metrics - Loss: 0.3939, Accuracy: 0.8043, Precision: 0.1523, Recall: 0.9005, AUC: 0.9260
2025-05-06 22:04:35,714 - INFO - Peak model training complete
2025-05-06 22:04:35,715 - INFO - peak model training completed successfully
2025-05-06 22:12:26,239 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-06 22:12:26,240 - INFO - Created all necessary directories
2025-05-06 22:12:26,240 - INFO - Loading data...
2025-05-06 22:12:26,240 - INFO - Loading and merging data...
2025-05-06 22:12:26,351 - INFO - Loaded price data: (73007, 11)
2025-05-06 22:12:26,351 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:12:26,451 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:12:26,457 - INFO - Merged grid data: (73007, 21)
2025-05-06 22:12:26,759 - INFO - Merged time features: (73007, 31)
2025-05-06 22:12:27,256 - INFO - Merged holiday data: (73007, 35)
2025-05-06 22:12:27,392 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:12:27,403 - INFO - Merged weather data: (73007, 41)
2025-05-06 22:12:27,411 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-06 22:12:27,415 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-06 22:12:27,597 - WARNING - Top gaps in 'price_24h_std':
2025-05-06 22:12:27,597 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-06 22:12:27,597 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-06 22:12:27,597 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-06 22:12:27,598 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-06 22:12:27,598 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-06 22:12:27,598 - WARNING -   ... and 73001 more gaps
2025-05-06 22:12:27,601 - WARNING -   Median gap size: 0.0 hours
2025-05-06 22:12:27,603 - WARNING -   Average gap size: 0.0 hours
2025-05-06 22:12:27,604 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-06 22:12:27,607 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 22:12:27,607 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:12:27,624 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-06 22:12:27,624 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-06 22:12:27,624 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:12:27,625 - INFO - === Starting peak model training (TCN) ===
2025-05-06 22:12:27,625 - INFO - Preparing data for is_price_peak model training...
2025-05-06 22:12:27,625 - INFO - Loading and merging data...
2025-05-06 22:12:27,738 - INFO - Loaded price data: (73007, 11)
2025-05-06 22:12:27,739 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:12:27,841 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:12:27,847 - INFO - Merged grid data: (73007, 21)
2025-05-06 22:12:28,150 - INFO - Merged time features: (73007, 31)
2025-05-06 22:12:28,650 - INFO - Merged holiday data: (73007, 35)
2025-05-06 22:12:28,769 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:12:28,782 - INFO - Merged weather data: (73007, 41)
2025-05-06 22:12:28,789 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-06 22:12:28,796 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-06 22:12:29,003 - WARNING - Top gaps in 'price_24h_std':
2025-05-06 22:12:29,003 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-06 22:12:29,003 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-06 22:12:29,004 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-06 22:12:29,004 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-06 22:12:29,004 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-06 22:12:29,004 - WARNING -   ... and 73001 more gaps
2025-05-06 22:12:29,007 - WARNING -   Median gap size: 0.0 hours
2025-05-06 22:12:29,009 - WARNING -   Average gap size: 0.0 hours
2025-05-06 22:12:29,011 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-06 22:12:29,014 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 22:12:29,014 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:12:29,021 - INFO - Adding lag features for trend detection...
2025-05-06 22:12:29,064 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-06 22:12:29,089 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-06 22:12:57,096 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 22:12:57,096 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 22:12:57,106 - INFO - Using robust peak detection algorithm for comparison
2025-05-06 22:13:00,088 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 22:13:00,091 - INFO - Using new robust valley detection algorithm
2025-05-06 22:13:03,060 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 22:13:03,062 - INFO - Using Scipy method for peak detection
2025-05-06 22:13:03,066 - INFO - Detected 1805 peaks (2.5% of data) and 14059 valleys (19.3% of data)
2025-05-06 22:13:03,068 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-06 22:13:03,068 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-06 22:13:03,070 - INFO - Using peak-specific features for model training
2025-05-06 22:13:03,070 - INFO - Using 24 features for is_price_peak detection
2025-05-06 22:13:03,081 - INFO - Data split: Train (51104, 24), Validation (10951, 24), Test (10952, 24)
2025-05-06 22:13:03,082 - INFO - Target distribution in train: 1.98% positive samples
2025-05-06 22:13:03,082 - INFO - Target distribution in val: 3.86% positive samples
2025-05-06 22:13:03,082 - INFO - Target distribution in test: 3.37% positive samples
2025-05-06 22:13:03,532 - INFO - Sequence shapes: X_train (50913, 168, 23), y_train (50913, 1)
2025-05-06 22:13:03,534 - INFO - Training peak detection model...
2025-05-06 22:13:03,534 - INFO - Generating peak label validation plots...
2025-05-06 22:13:08,151 - INFO - Peak detection validation plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_validation
2025-05-06 22:13:08,151 - INFO - Generating peak detection method comparison plots...
2025-05-06 22:13:08,155 - INFO - Applying different peak detection methods for comparison...
2025-05-06 22:13:08,157 - INFO - Traditional threshold method: 7301 peaks (10.0% of data)
2025-05-06 22:13:36,736 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 22:13:36,736 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 22:13:36,741 - INFO - Relative detection method: 398 peaks (0.5% of data)
2025-05-06 22:13:39,799 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 22:13:39,800 - INFO - Robust detection method: 14836 peaks (20.3% of data)
2025-05-06 22:13:39,803 - INFO - Simple scipy method: 4709 peaks (6.5% of data)
2025-05-06 22:13:40,104 - INFO - Local maxima method: 2502 peaks (3.4% of data)
2025-05-06 22:13:42,994 - INFO - Peak detection method comparison plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_method_comparison
2025-05-06 22:13:42,995 - INFO - Saved feature list with 23 features
2025-05-06 22:13:42,996 - INFO - Saved feature scaler
2025-05-06 22:13:42,996 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'scipy', 'peak_prominence': 27.805590000000002, 'peak_distance': 4, 'peak_width': 2, 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-06 22:13:43,771 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-06 22:13:43,924 - INFO - Built peak model with input shape (168, 23)
2025-05-06 22:13:43,924 - INFO - Class weights: {0: 1, 1: 49.359050445103854}
2025-05-06 22:13:43,936 - INFO - Training with validation data (shape: (10760, 168, 23))
2025-05-06 22:15:03,450 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-06 22:15:03,451 - INFO - Created all necessary directories
2025-05-06 22:15:03,451 - INFO - Loading data...
2025-05-06 22:15:03,451 - INFO - Loading and merging data...
2025-05-06 22:15:03,553 - INFO - Loaded price data: (73007, 11)
2025-05-06 22:15:03,553 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:15:03,644 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:15:03,650 - INFO - Merged grid data: (73007, 21)
2025-05-06 22:15:03,927 - INFO - Merged time features: (73007, 31)
2025-05-06 22:15:04,380 - INFO - Merged holiday data: (73007, 35)
2025-05-06 22:15:04,492 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:15:04,505 - INFO - Merged weather data: (73007, 41)
2025-05-06 22:15:04,514 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-06 22:15:04,520 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-06 22:15:04,697 - WARNING - Top gaps in 'price_24h_std':
2025-05-06 22:15:04,698 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-06 22:15:04,698 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-06 22:15:04,698 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-06 22:15:04,698 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-06 22:15:04,698 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-06 22:15:04,698 - WARNING -   ... and 73001 more gaps
2025-05-06 22:15:04,701 - WARNING -   Median gap size: 0.0 hours
2025-05-06 22:15:04,703 - WARNING -   Average gap size: 0.0 hours
2025-05-06 22:15:04,704 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-06 22:15:04,707 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 22:15:04,707 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:15:04,720 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-06 22:15:04,721 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-06 22:15:04,721 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:15:04,721 - INFO - === Starting peak model training (TCN) ===
2025-05-06 22:15:04,721 - INFO - Preparing data for is_price_peak model training...
2025-05-06 22:15:04,722 - INFO - Loading and merging data...
2025-05-06 22:15:04,819 - INFO - Loaded price data: (73007, 11)
2025-05-06 22:15:04,819 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:15:04,909 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:15:04,914 - INFO - Merged grid data: (73007, 21)
2025-05-06 22:15:05,181 - INFO - Merged time features: (73007, 31)
2025-05-06 22:15:05,630 - INFO - Merged holiday data: (73007, 35)
2025-05-06 22:15:05,736 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:15:05,748 - INFO - Merged weather data: (73007, 41)
2025-05-06 22:15:05,755 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-06 22:15:05,758 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-06 22:15:05,936 - WARNING - Top gaps in 'price_24h_std':
2025-05-06 22:15:05,937 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-06 22:15:05,937 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-06 22:15:05,937 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-06 22:15:05,937 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-06 22:15:05,937 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-06 22:15:05,937 - WARNING -   ... and 73001 more gaps
2025-05-06 22:15:05,940 - WARNING -   Median gap size: 0.0 hours
2025-05-06 22:15:05,942 - WARNING -   Average gap size: 0.0 hours
2025-05-06 22:15:05,943 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-06 22:15:05,946 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-06 22:15:05,946 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 22:15:05,953 - INFO - Adding lag features for trend detection...
2025-05-06 22:15:05,992 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-06 22:15:06,013 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-06 22:15:32,930 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 22:15:32,930 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 22:15:32,940 - INFO - Using robust peak detection algorithm for comparison
2025-05-06 22:15:35,996 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 22:15:35,999 - INFO - Using new robust valley detection algorithm
2025-05-06 22:15:38,914 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 22:15:38,917 - INFO - Using Scipy method for peak detection
2025-05-06 22:15:38,920 - INFO - Detected 1805 peaks (2.5% of data) and 14059 valleys (19.3% of data)
2025-05-06 22:15:38,922 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-06 22:15:38,922 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-06 22:15:38,923 - INFO - Using peak-specific features for model training
2025-05-06 22:15:38,923 - INFO - Using 24 features for is_price_peak detection
2025-05-06 22:15:38,934 - INFO - Data split: Train (51104, 24), Validation (10951, 24), Test (10952, 24)
2025-05-06 22:15:38,934 - INFO - Target distribution in train: 1.98% positive samples
2025-05-06 22:15:38,934 - INFO - Target distribution in val: 3.86% positive samples
2025-05-06 22:15:38,934 - INFO - Target distribution in test: 3.37% positive samples
2025-05-06 22:15:39,396 - INFO - Sequence shapes: X_train (50913, 168, 23), y_train (50913, 1)
2025-05-06 22:15:39,397 - INFO - Training peak detection model...
2025-05-06 22:15:39,397 - INFO - Generating peak label validation plots...
2025-05-06 22:15:43,720 - INFO - Peak detection validation plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_validation
2025-05-06 22:15:43,720 - INFO - Generating peak detection method comparison plots...
2025-05-06 22:15:43,724 - INFO - Applying different peak detection methods for comparison...
2025-05-06 22:15:43,726 - INFO - Traditional threshold method: 7301 peaks (10.0% of data)
2025-05-06 22:16:10,580 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-06 22:16:10,581 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-06 22:16:10,586 - INFO - Relative detection method: 398 peaks (0.5% of data)
2025-05-06 22:16:13,515 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-06 22:16:13,517 - INFO - Robust detection method: 14836 peaks (20.3% of data)
2025-05-06 22:16:13,521 - INFO - Simple scipy method: 4709 peaks (6.5% of data)
2025-05-06 22:16:13,821 - INFO - Local maxima method: 2502 peaks (3.4% of data)
2025-05-06 22:16:16,725 - INFO - Peak detection method comparison plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_method_comparison
2025-05-06 22:16:16,726 - INFO - Saved feature list with 23 features
2025-05-06 22:16:16,727 - INFO - Saved feature scaler
2025-05-06 22:16:16,727 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'scipy', 'peak_prominence': 27.805590000000002, 'peak_distance': 4, 'peak_width': 2, 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-06 22:16:17,508 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-06 22:16:17,666 - INFO - Built peak model with input shape (168, 23)
2025-05-06 22:16:17,666 - INFO - Class weights: {0: 1, 1: 49.359050445103854}
2025-05-06 22:16:17,677 - INFO - Training with validation data (shape: (10760, 168, 23))
2025-05-07 15:46:20,941 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-07 15:46:20,942 - INFO - Created all necessary directories
2025-05-07 15:46:20,942 - INFO - Running in PRODUCTION MODE with all available data!
2025-05-07 15:46:20,942 - INFO - Loading data...
2025-05-07 15:46:20,943 - INFO - Loading and merging data...
2025-05-07 15:46:21,046 - INFO - Loaded price data: (73162, 11)
2025-05-07 15:46:21,047 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-05-07 10:00:00+00:00
2025-05-07 15:46:21,140 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-05-07 07:00:00+00:00
2025-05-07 15:46:21,147 - INFO - Merged grid data: (73162, 21)
2025-05-07 15:46:21,466 - INFO - Merged time features: (73162, 31)
2025-05-07 15:46:21,941 - INFO - Merged holiday data: (73162, 35)
2025-05-07 15:46:22,050 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-05-03 21:00:00+00:00
2025-05-07 15:46:22,058 - INFO - Merged weather data: (73162, 41)
2025-05-07 15:46:22,067 - WARNING - Found missing values after merging: price_24h_std                1
Gas_Price                  155
Coal_Price                 155
CO2_Price                  155
powerConsumptionTotal        3
powerProductionTotal         3
powerImportTotal             3
powerExportTotal             3
nuclear                      3
wind                         3
hydro                        3
solar                        3
renewablePercentage          3
fossilFreePercentage         3
temperature_2m              85
cloud_cover                 85
relative_humidity_2m        85
wind_speed_100m             85
wind_direction_100m         85
shortwave_radiation_sum     85
dtype: int64
2025-05-07 15:46:22,070 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-07 15:46:22,248 - WARNING - Top gaps in 'price_24h_std':
2025-05-07 15:46:22,248 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:22,249 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-07 15:46:22,249 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-07 15:46:22,249 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-07 15:46:22,249 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-07 15:46:22,250 - WARNING -   ... and 73156 more gaps
2025-05-07 15:46:22,252 - WARNING -   Median gap size: 0.0 hours
2025-05-07 15:46:22,255 - WARNING -   Average gap size: 0.0 hours
2025-05-07 15:46:22,255 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-07 15:46:22,256 - WARNING - Missing values in 'Gas_Price': 155 rows (0.21%)
2025-05-07 15:46:22,430 - WARNING - Top gaps in 'Gas_Price':
2025-05-07 15:46:22,431 - WARNING -   Gap #1: 2025-04-30 23:00:00+00:00 to 2025-05-07 10:00:00+00:00 (156 hours)
2025-05-07 15:46:22,431 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:22,431 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:22,431 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:22,431 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:22,431 - WARNING -   ... and 73002 more gaps
2025-05-07 15:46:22,434 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:22,436 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:22,437 - INFO - Filled missing values in Gas_Price with forward/backward fill
2025-05-07 15:46:22,437 - WARNING - Missing values in 'Coal_Price': 155 rows (0.21%)
2025-05-07 15:46:22,762 - WARNING - Top gaps in 'Coal_Price':
2025-05-07 15:46:22,762 - WARNING -   Gap #1: 2025-04-30 23:00:00+00:00 to 2025-05-07 10:00:00+00:00 (156 hours)
2025-05-07 15:46:22,762 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:22,762 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:22,762 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:22,762 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:22,762 - WARNING -   ... and 73002 more gaps
2025-05-07 15:46:22,765 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:22,767 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:22,768 - INFO - Filled missing values in Coal_Price with forward/backward fill
2025-05-07 15:46:22,768 - WARNING - Missing values in 'CO2_Price': 155 rows (0.21%)
2025-05-07 15:46:22,941 - WARNING - Top gaps in 'CO2_Price':
2025-05-07 15:46:22,941 - WARNING -   Gap #1: 2025-04-30 23:00:00+00:00 to 2025-05-07 10:00:00+00:00 (156 hours)
2025-05-07 15:46:22,941 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:22,941 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:22,942 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:22,942 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:22,942 - WARNING -   ... and 73002 more gaps
2025-05-07 15:46:22,944 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:22,947 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:22,947 - INFO - Filled missing values in CO2_Price with forward/backward fill
2025-05-07 15:46:22,948 - WARNING - Missing values in 'powerConsumptionTotal': 3 rows (0.00%)
2025-05-07 15:46:23,115 - WARNING - Top gaps in 'powerConsumptionTotal':
2025-05-07 15:46:23,116 - WARNING -   Gap #1: 2025-05-07 07:00:00+00:00 to 2025-05-07 10:00:00+00:00 (4 hours)
2025-05-07 15:46:23,116 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:23,116 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:23,116 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:23,116 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:23,116 - WARNING -   ... and 73154 more gaps
2025-05-07 15:46:23,118 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:23,121 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:23,122 - INFO - Filled missing values in powerConsumptionTotal with forward/backward fill
2025-05-07 15:46:23,122 - WARNING - Missing values in 'powerProductionTotal': 3 rows (0.00%)
2025-05-07 15:46:23,295 - WARNING - Top gaps in 'powerProductionTotal':
2025-05-07 15:46:23,295 - WARNING -   Gap #1: 2025-05-07 07:00:00+00:00 to 2025-05-07 10:00:00+00:00 (4 hours)
2025-05-07 15:46:23,295 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:23,295 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:23,295 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:23,295 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:23,296 - WARNING -   ... and 73154 more gaps
2025-05-07 15:46:23,298 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:23,300 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:23,301 - INFO - Filled missing values in powerProductionTotal with forward/backward fill
2025-05-07 15:46:23,301 - WARNING - Missing values in 'powerImportTotal': 3 rows (0.00%)
2025-05-07 15:46:23,474 - WARNING - Top gaps in 'powerImportTotal':
2025-05-07 15:46:23,475 - WARNING -   Gap #1: 2025-05-07 07:00:00+00:00 to 2025-05-07 10:00:00+00:00 (4 hours)
2025-05-07 15:46:23,475 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:23,475 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:23,475 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:23,475 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:23,475 - WARNING -   ... and 73154 more gaps
2025-05-07 15:46:23,478 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:23,481 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:23,481 - INFO - Filled missing values in powerImportTotal with forward/backward fill
2025-05-07 15:46:23,482 - WARNING - Missing values in 'powerExportTotal': 3 rows (0.00%)
2025-05-07 15:46:23,808 - WARNING - Top gaps in 'powerExportTotal':
2025-05-07 15:46:23,808 - WARNING -   Gap #1: 2025-05-07 07:00:00+00:00 to 2025-05-07 10:00:00+00:00 (4 hours)
2025-05-07 15:46:23,808 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:23,808 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:23,808 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:23,809 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:23,809 - WARNING -   ... and 73154 more gaps
2025-05-07 15:46:23,811 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:23,814 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:23,815 - INFO - Filled missing values in powerExportTotal with forward/backward fill
2025-05-07 15:46:23,815 - WARNING - Missing values in 'nuclear': 3 rows (0.00%)
2025-05-07 15:46:23,982 - WARNING - Top gaps in 'nuclear':
2025-05-07 15:46:23,983 - WARNING -   Gap #1: 2025-05-07 07:00:00+00:00 to 2025-05-07 10:00:00+00:00 (4 hours)
2025-05-07 15:46:23,983 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:23,983 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:23,983 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:23,983 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:23,984 - WARNING -   ... and 73154 more gaps
2025-05-07 15:46:23,986 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:23,988 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:23,989 - INFO - Filled missing values in nuclear with forward/backward fill
2025-05-07 15:46:23,990 - WARNING - Missing values in 'wind': 3 rows (0.00%)
2025-05-07 15:46:24,158 - WARNING - Top gaps in 'wind':
2025-05-07 15:46:24,159 - WARNING -   Gap #1: 2025-05-07 07:00:00+00:00 to 2025-05-07 10:00:00+00:00 (4 hours)
2025-05-07 15:46:24,159 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:24,159 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:24,159 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:24,159 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:24,159 - WARNING -   ... and 73154 more gaps
2025-05-07 15:46:24,162 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:24,165 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:24,165 - INFO - Filled missing values in wind with forward/backward fill
2025-05-07 15:46:24,166 - WARNING - Missing values in 'hydro': 3 rows (0.00%)
2025-05-07 15:46:24,338 - WARNING - Top gaps in 'hydro':
2025-05-07 15:46:24,338 - WARNING -   Gap #1: 2025-05-07 07:00:00+00:00 to 2025-05-07 10:00:00+00:00 (4 hours)
2025-05-07 15:46:24,339 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:24,339 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:24,339 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:24,340 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:24,340 - WARNING -   ... and 73154 more gaps
2025-05-07 15:46:24,342 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:24,345 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:24,346 - INFO - Filled missing values in hydro with forward/backward fill
2025-05-07 15:46:24,346 - WARNING - Missing values in 'solar': 3 rows (0.00%)
2025-05-07 15:46:24,512 - WARNING - Top gaps in 'solar':
2025-05-07 15:46:24,513 - WARNING -   Gap #1: 2025-05-07 07:00:00+00:00 to 2025-05-07 10:00:00+00:00 (4 hours)
2025-05-07 15:46:24,513 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:24,513 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:24,513 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:24,513 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:24,513 - WARNING -   ... and 73154 more gaps
2025-05-07 15:46:24,516 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:24,518 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:24,519 - INFO - Filled missing values in solar with forward/backward fill
2025-05-07 15:46:24,520 - WARNING - Missing values in 'renewablePercentage': 3 rows (0.00%)
2025-05-07 15:46:24,848 - WARNING - Top gaps in 'renewablePercentage':
2025-05-07 15:46:24,848 - WARNING -   Gap #1: 2025-05-07 07:00:00+00:00 to 2025-05-07 10:00:00+00:00 (4 hours)
2025-05-07 15:46:24,848 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:24,848 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:24,849 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:24,849 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:24,849 - WARNING -   ... and 73154 more gaps
2025-05-07 15:46:24,852 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:24,854 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:24,855 - INFO - Filled missing values in renewablePercentage with forward/backward fill
2025-05-07 15:46:24,856 - WARNING - Missing values in 'fossilFreePercentage': 3 rows (0.00%)
2025-05-07 15:46:25,024 - WARNING - Top gaps in 'fossilFreePercentage':
2025-05-07 15:46:25,024 - WARNING -   Gap #1: 2025-05-07 07:00:00+00:00 to 2025-05-07 10:00:00+00:00 (4 hours)
2025-05-07 15:46:25,024 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:25,024 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:25,025 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:25,025 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:25,025 - WARNING -   ... and 73154 more gaps
2025-05-07 15:46:25,028 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:25,030 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:25,031 - INFO - Filled missing values in fossilFreePercentage with forward/backward fill
2025-05-07 15:46:25,033 - WARNING - Missing values in 'temperature_2m': 85 rows (0.12%)
2025-05-07 15:46:25,196 - WARNING - Top gaps in 'temperature_2m':
2025-05-07 15:46:25,197 - WARNING -   Gap #1: 2025-05-03 21:00:00+00:00 to 2025-05-07 10:00:00+00:00 (86 hours)
2025-05-07 15:46:25,197 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:25,197 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:25,197 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:25,197 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:25,197 - WARNING -   ... and 73072 more gaps
2025-05-07 15:46:25,200 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:25,202 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:25,203 - INFO - Filled missing values in temperature_2m with forward/backward fill
2025-05-07 15:46:25,203 - WARNING - Missing values in 'cloud_cover': 85 rows (0.12%)
2025-05-07 15:46:25,377 - WARNING - Top gaps in 'cloud_cover':
2025-05-07 15:46:25,378 - WARNING -   Gap #1: 2025-05-03 21:00:00+00:00 to 2025-05-07 10:00:00+00:00 (86 hours)
2025-05-07 15:46:25,378 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:25,378 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:25,379 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:25,379 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:25,379 - WARNING -   ... and 73072 more gaps
2025-05-07 15:46:25,381 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:25,384 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:25,384 - INFO - Filled missing values in cloud_cover with forward/backward fill
2025-05-07 15:46:25,385 - WARNING - Missing values in 'relative_humidity_2m': 85 rows (0.12%)
2025-05-07 15:46:25,550 - WARNING - Top gaps in 'relative_humidity_2m':
2025-05-07 15:46:25,550 - WARNING -   Gap #1: 2025-05-03 21:00:00+00:00 to 2025-05-07 10:00:00+00:00 (86 hours)
2025-05-07 15:46:25,550 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:25,550 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:25,551 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:25,551 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:25,551 - WARNING -   ... and 73072 more gaps
2025-05-07 15:46:25,553 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:25,556 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:25,556 - INFO - Filled missing values in relative_humidity_2m with forward/backward fill
2025-05-07 15:46:25,557 - WARNING - Missing values in 'wind_speed_100m': 85 rows (0.12%)
2025-05-07 15:46:25,723 - WARNING - Top gaps in 'wind_speed_100m':
2025-05-07 15:46:25,723 - WARNING -   Gap #1: 2025-05-03 21:00:00+00:00 to 2025-05-07 10:00:00+00:00 (86 hours)
2025-05-07 15:46:25,724 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:25,724 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:25,724 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:25,724 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:25,724 - WARNING -   ... and 73072 more gaps
2025-05-07 15:46:25,727 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:25,729 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:25,730 - INFO - Filled missing values in wind_speed_100m with forward/backward fill
2025-05-07 15:46:25,731 - WARNING - Missing values in 'wind_direction_100m': 85 rows (0.12%)
2025-05-07 15:46:26,045 - WARNING - Top gaps in 'wind_direction_100m':
2025-05-07 15:46:26,045 - WARNING -   Gap #1: 2025-05-03 21:00:00+00:00 to 2025-05-07 10:00:00+00:00 (86 hours)
2025-05-07 15:46:26,045 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:26,045 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:26,046 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:26,046 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:26,046 - WARNING -   ... and 73072 more gaps
2025-05-07 15:46:26,048 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:26,051 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:26,052 - INFO - Filled missing values in wind_direction_100m with forward/backward fill
2025-05-07 15:46:26,052 - WARNING - Missing values in 'shortwave_radiation_sum': 85 rows (0.12%)
2025-05-07 15:46:26,217 - WARNING - Top gaps in 'shortwave_radiation_sum':
2025-05-07 15:46:26,217 - WARNING -   Gap #1: 2025-05-03 21:00:00+00:00 to 2025-05-07 10:00:00+00:00 (86 hours)
2025-05-07 15:46:26,217 - WARNING -   Gap #2: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:46:26,218 - WARNING -   Gap #3: 2017-01-01 01:00:00+00:00 to 2017-01-01 01:00:00+00:00 (1 hours)
2025-05-07 15:46:26,218 - WARNING -   Gap #4: 2017-01-01 02:00:00+00:00 to 2017-01-01 02:00:00+00:00 (1 hours)
2025-05-07 15:46:26,218 - WARNING -   Gap #5: 2017-01-01 03:00:00+00:00 to 2017-01-01 03:00:00+00:00 (1 hours)
2025-05-07 15:46:26,218 - WARNING -   ... and 73072 more gaps
2025-05-07 15:46:26,220 - WARNING -   Median gap size: 1.0 hours
2025-05-07 15:46:26,223 - WARNING -   Average gap size: 1.0 hours
2025-05-07 15:46:26,223 - INFO - Filled missing values in shortwave_radiation_sum with forward/backward fill
2025-05-07 15:46:26,224 - INFO - Final merged dataframe shape: (73162, 41)
2025-05-07 15:46:26,224 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-05-07 10:00:00+00:00
2025-05-07 15:46:26,243 - INFO - Train size: 51213, from 2017-01-01 00:00:00+00:00 to 2022-11-04 20:00:00+00:00
2025-05-07 15:46:26,243 - INFO - Validation size: 10974, from 2022-11-04 21:00:00+00:00 to 2024-02-05 02:00:00+00:00
2025-05-07 15:46:26,243 - INFO - Test size: 10975, from 2024-02-05 03:00:00+00:00 to 2025-05-07 10:00:00+00:00
2025-05-07 15:46:26,243 - INFO - === Starting peak model training (TCN) ===
2025-05-07 15:46:26,244 - INFO - Preparing data for is_price_peak model training...
2025-05-07 15:46:26,244 - INFO - Loading and merging data...
2025-05-07 15:48:27,035 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-07 15:48:27,036 - INFO - Created all necessary directories
2025-05-07 15:48:27,037 - INFO - Running in PRODUCTION MODE with all available data!
2025-05-07 15:48:27,037 - INFO - Loading data...
2025-05-07 15:48:27,037 - INFO - Loading and merging data...
2025-05-07 15:48:27,153 - INFO - Loaded price data: (73007, 11)
2025-05-07 15:48:27,154 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 15:48:27,248 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 15:48:27,254 - INFO - Merged grid data: (73007, 21)
2025-05-07 15:48:27,538 - INFO - Merged time features: (73007, 31)
2025-05-07 15:48:28,003 - INFO - Merged holiday data: (73007, 35)
2025-05-07 15:48:28,115 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 15:48:28,131 - INFO - Merged weather data: (73007, 41)
2025-05-07 15:48:28,140 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-07 15:48:28,144 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-07 15:48:28,331 - WARNING - Top gaps in 'price_24h_std':
2025-05-07 15:48:28,332 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:48:28,332 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-07 15:48:28,332 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-07 15:48:28,332 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-07 15:48:28,332 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-07 15:48:28,332 - WARNING -   ... and 73001 more gaps
2025-05-07 15:48:28,335 - WARNING -   Median gap size: 0.0 hours
2025-05-07 15:48:28,337 - WARNING -   Average gap size: 0.0 hours
2025-05-07 15:48:28,338 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-07 15:48:28,341 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-07 15:48:28,341 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 15:48:28,359 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-07 15:48:28,360 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-07 15:48:28,360 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 15:48:28,360 - INFO - === Starting peak model training (TCN) ===
2025-05-07 15:48:28,360 - INFO - Preparing data for is_price_peak model training...
2025-05-07 15:48:28,361 - INFO - Loading and merging data...
2025-05-07 15:48:28,468 - INFO - Loaded price data: (73007, 11)
2025-05-07 15:48:28,469 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 15:48:28,564 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 15:48:28,570 - INFO - Merged grid data: (73007, 21)
2025-05-07 15:48:28,871 - INFO - Merged time features: (73007, 31)
2025-05-07 15:48:29,359 - INFO - Merged holiday data: (73007, 35)
2025-05-07 15:48:29,470 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 15:48:29,484 - INFO - Merged weather data: (73007, 41)
2025-05-07 15:48:29,492 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-07 15:48:29,496 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-07 15:48:29,675 - WARNING - Top gaps in 'price_24h_std':
2025-05-07 15:48:29,675 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 15:48:29,675 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-07 15:48:29,675 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-07 15:48:29,676 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-07 15:48:29,676 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-07 15:48:29,676 - WARNING -   ... and 73001 more gaps
2025-05-07 15:48:29,678 - WARNING -   Median gap size: 0.0 hours
2025-05-07 15:48:29,681 - WARNING -   Average gap size: 0.0 hours
2025-05-07 15:48:29,682 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-07 15:48:29,684 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-07 15:48:29,684 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 15:48:29,691 - INFO - Adding lag features for trend detection...
2025-05-07 15:48:29,733 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-07 15:48:29,755 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-07 15:48:56,598 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-07 15:48:56,598 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-07 15:48:56,609 - INFO - Using robust peak detection algorithm for comparison
2025-05-07 15:48:59,595 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-07 15:48:59,598 - INFO - Using new robust valley detection algorithm
2025-05-07 15:49:02,675 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-07 15:49:02,678 - INFO - Using Scipy method for peak detection
2025-05-07 15:49:02,683 - INFO - Detected 1805 peaks (2.5% of data) and 14059 valleys (19.3% of data)
2025-05-07 15:49:02,684 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-07 15:49:02,684 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-07 15:49:02,686 - INFO - Using peak-specific features for model training
2025-05-07 15:49:02,687 - INFO - Using 24 features for is_price_peak detection
2025-05-07 15:49:02,699 - INFO - PRODUCTION MODE: Using ALL available data for training
2025-05-07 15:49:02,701 - INFO - Combined data shape: (73007, 24)
2025-05-07 15:49:02,701 - INFO - Target distribution in combined data: 2.47% positive samples
2025-05-07 15:49:03,425 - INFO - Prepared training data: X_train shape (72816, 168, 23), y_train shape (72816, 1)
2025-05-07 15:49:03,428 - INFO - Training peak detection model...
2025-05-07 15:49:03,428 - INFO - PRODUCTION MODE: Using all available data for training
2025-05-07 15:49:03,428 - INFO - Generating peak label validation plots...
2025-05-07 15:49:07,926 - INFO - Peak detection validation plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_validation
2025-05-07 15:49:07,926 - INFO - Generating peak detection method comparison plots...
2025-05-07 15:49:07,930 - INFO - Applying different peak detection methods for comparison...
2025-05-07 15:49:07,932 - INFO - Traditional threshold method: 7301 peaks (10.0% of data)
2025-05-07 15:49:37,350 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-07 15:49:37,351 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-07 15:49:37,357 - INFO - Relative detection method: 398 peaks (0.5% of data)
2025-05-07 15:49:40,535 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-07 15:49:40,536 - INFO - Robust detection method: 14836 peaks (20.3% of data)
2025-05-07 15:49:40,540 - INFO - Simple scipy method: 4709 peaks (6.5% of data)
2025-05-07 15:49:40,892 - INFO - Local maxima method: 2502 peaks (3.4% of data)
2025-05-07 15:49:44,213 - INFO - Peak detection method comparison plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_method_comparison
2025-05-07 15:49:44,214 - INFO - Saved feature list with 23 features
2025-05-07 15:49:44,215 - INFO - Saved feature scaler
2025-05-07 15:49:44,216 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'scipy', 'peak_prominence': 27.805590000000002, 'peak_distance': 4, 'peak_width': 2, 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-07 15:49:45,057 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-07 15:49:45,218 - INFO - Built peak model with input shape (168, 23)
2025-05-07 15:49:45,218 - INFO - Class weights: {0: 1, 1: 39.38602329450915}
2025-05-07 15:49:45,218 - INFO - Added production-mode callbacks
2025-05-07 15:49:45,230 - INFO - Training without validation in production mode
2025-05-07 16:56:32,596 - INFO - Logging configured for peak model. Log file: C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training.log
2025-05-07 16:56:32,597 - INFO - Created all necessary directories
2025-05-07 16:56:32,597 - INFO - Running in PRODUCTION MODE with all available data!
2025-05-07 16:56:32,597 - INFO - Loading data...
2025-05-07 16:56:32,597 - INFO - Loading and merging data...
2025-05-07 16:56:32,709 - INFO - Loaded price data: (73007, 11)
2025-05-07 16:56:32,709 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 16:56:32,812 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 16:56:32,817 - INFO - Merged grid data: (73007, 21)
2025-05-07 16:56:33,110 - INFO - Merged time features: (73007, 31)
2025-05-07 16:56:33,631 - INFO - Merged holiday data: (73007, 35)
2025-05-07 16:56:33,753 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 16:56:33,767 - INFO - Merged weather data: (73007, 41)
2025-05-07 16:56:33,776 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-07 16:56:33,779 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-07 16:56:33,977 - WARNING - Top gaps in 'price_24h_std':
2025-05-07 16:56:33,977 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 16:56:33,977 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-07 16:56:33,977 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-07 16:56:33,977 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-07 16:56:33,978 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-07 16:56:33,978 - WARNING -   ... and 73001 more gaps
2025-05-07 16:56:33,981 - WARNING -   Median gap size: 0.0 hours
2025-05-07 16:56:33,983 - WARNING -   Average gap size: 0.0 hours
2025-05-07 16:56:33,984 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-07 16:56:33,987 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-07 16:56:33,987 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 16:56:34,003 - INFO - Train size: 51104, from 2017-01-01 00:00:00+00:00 to 2022-10-31 07:00:00+00:00
2025-05-07 16:56:34,004 - INFO - Validation size: 10951, from 2022-10-31 08:00:00+00:00 to 2024-01-30 14:00:00+00:00
2025-05-07 16:56:34,004 - INFO - Test size: 10952, from 2024-01-30 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 16:56:34,004 - INFO - === Starting peak model training (TCN) ===
2025-05-07 16:56:34,005 - INFO - Preparing data for is_price_peak model training...
2025-05-07 16:56:34,005 - INFO - Loading and merging data...
2025-05-07 16:56:34,124 - INFO - Loaded price data: (73007, 11)
2025-05-07 16:56:34,125 - INFO - Price data date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 16:56:34,226 - INFO - Grid data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 16:56:34,234 - INFO - Merged grid data: (73007, 21)
2025-05-07 16:56:34,524 - INFO - Merged time features: (73007, 31)
2025-05-07 16:56:35,011 - INFO - Merged holiday data: (73007, 35)
2025-05-07 16:56:35,121 - INFO - Weather data range after trimming: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 16:56:35,133 - INFO - Merged weather data: (73007, 41)
2025-05-07 16:56:35,140 - WARNING - Found missing values after merging: price_24h_std    1
dtype: int64
2025-05-07 16:56:35,144 - WARNING - Missing values in 'price_24h_std': 1 rows (0.00%)
2025-05-07 16:56:35,326 - WARNING - Top gaps in 'price_24h_std':
2025-05-07 16:56:35,327 - WARNING -   Gap #1: 2017-01-01 00:00:00+00:00 to 2017-01-01 00:00:00+00:00 (1 hours)
2025-05-07 16:56:35,327 - WARNING -   Gap #2: 2017-10-29 02:00:00+00:00 to 2017-10-29 02:00:00+00:00 (1 hours)
2025-05-07 16:56:35,327 - WARNING -   Gap #3: 2018-10-28 02:00:00+00:00 to 2018-10-28 02:00:00+00:00 (1 hours)
2025-05-07 16:56:35,327 - WARNING -   Gap #4: 2019-10-27 02:00:00+00:00 to 2019-10-27 02:00:00+00:00 (1 hours)
2025-05-07 16:56:35,327 - WARNING -   Gap #5: 2020-10-25 02:00:00+00:00 to 2020-10-25 02:00:00+00:00 (1 hours)
2025-05-07 16:56:35,327 - WARNING -   ... and 73001 more gaps
2025-05-07 16:56:35,330 - WARNING -   Median gap size: 0.0 hours
2025-05-07 16:56:35,333 - WARNING -   Average gap size: 0.0 hours
2025-05-07 16:56:35,333 - INFO - Filled missing values in price_24h_std with forward/backward fill
2025-05-07 16:56:35,336 - INFO - Final merged dataframe shape: (73007, 41)
2025-05-07 16:56:35,337 - INFO - Date range: 2017-01-01 00:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-07 16:56:35,344 - INFO - Adding lag features for trend detection...
2025-05-07 16:56:35,391 - INFO - Added 9 lag features and 4 momentum/detrended features
2025-05-07 16:56:35,412 - INFO - Using improved relative peak detection for peak/valley identification
2025-05-07 16:57:06,216 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-07 16:57:06,217 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-07 16:57:06,230 - INFO - Using robust peak detection algorithm for comparison
2025-05-07 16:57:09,231 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-07 16:57:09,234 - INFO - Using new robust valley detection algorithm
2025-05-07 16:57:12,241 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-07 16:57:12,247 - INFO - Using Scipy method for peak detection
2025-05-07 16:57:12,256 - INFO - Detected 1805 peaks (2.5% of data) and 14059 valleys (19.3% of data)
2025-05-07 16:57:12,260 - INFO - For reference - traditional method would detect 7301 peaks (10.0% of data)
2025-05-07 16:57:12,260 - INFO - Traditional thresholds - spike: 115.66, valley: 8.26
2025-05-07 16:57:12,261 - INFO - Using peak-specific features for model training
2025-05-07 16:57:12,261 - INFO - Using 24 features for is_price_peak detection
2025-05-07 16:57:12,280 - INFO - PRODUCTION MODE: Using ALL available data for training
2025-05-07 16:57:12,283 - INFO - Combined data shape: (73007, 24)
2025-05-07 16:57:12,283 - INFO - Target distribution in combined data: 2.47% positive samples
2025-05-07 16:57:12,771 - INFO - Prepared training data: X_train shape (72816, 168, 23), y_train shape (72816, 1)
2025-05-07 16:57:12,774 - INFO - Training peak detection model...
2025-05-07 16:57:12,775 - INFO - PRODUCTION MODE: Using all available data for training
2025-05-07 16:57:12,775 - INFO - Generating peak label validation plots...
2025-05-07 16:57:17,129 - INFO - Peak detection validation plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_validation
2025-05-07 16:57:17,129 - INFO - Generating peak detection method comparison plots...
2025-05-07 16:57:17,133 - INFO - Applying different peak detection methods for comparison...
2025-05-07 16:57:17,135 - INFO - Traditional threshold method: 7301 peaks (10.0% of data)
2025-05-07 16:57:50,296 - INFO - Detected 398 peaks (0.5% of data) and 519 valleys (0.7% of data)
2025-05-07 16:57:50,296 - INFO - Using window=24h, relative_height=0.20, distance=6h, prominence=0.15
2025-05-07 16:57:50,302 - INFO - Relative detection method: 398 peaks (0.5% of data)
2025-05-07 16:57:53,530 - INFO - Robust peak detection found 14836 peaks (20.3% of data)
2025-05-07 16:57:53,532 - INFO - Robust detection method: 14836 peaks (20.3% of data)
2025-05-07 16:57:53,537 - INFO - Simple scipy method: 4709 peaks (6.5% of data)
2025-05-07 16:57:53,954 - INFO - Local maxima method: 2502 peaks (3.4% of data)
2025-05-07 16:57:57,237 - INFO - Peak detection method comparison plots saved to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_method_comparison
2025-05-07 16:57:57,237 - INFO - Saved feature list with 23 features
2025-05-07 16:57:57,239 - INFO - Saved feature scaler
2025-05-07 16:57:57,239 - INFO - Saved thresholds: {'spike_threshold': 115.66180000000014, 'valley_threshold': 8.2626, 'method': 'scipy', 'peak_prominence': 27.805590000000002, 'peak_distance': 4, 'peak_width': 2, 'min_prominence': 0.03, 'min_width': 1, 'distance': 2, 'depth_percentile': 15, 'smoothing_window': 3}
2025-05-07 16:57:58,067 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-07 16:57:58,240 - INFO - Built peak model with input shape (168, 23)
2025-05-07 16:57:58,240 - INFO - Class weights: {0: 1, 1: 39.38602329450915}
2025-05-07 16:57:58,241 - INFO - Added production-mode callbacks
2025-05-07 16:57:58,252 - INFO - Training without validation in production mode
2025-05-07 19:38:21,034 - INFO - Training completed in production mode. Best training loss 0.2684 at epoch 50
2025-05-07 19:38:21,039 - INFO - Saved training summary to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\peak_model_training_summary.json
2025-05-07 19:38:21,204 - INFO - Saved model to C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\final_peak_model.keras
2025-05-07 19:38:21,362 - INFO - In production mode, also saved model as C:\_Projects\home-energy-ai\src\predictions\prices\models\peak_model\best_peak_model.keras
2025-05-07 19:38:21,366 - INFO - Peak model training complete
2025-05-07 19:38:21,366 - INFO - peak model training completed successfully
