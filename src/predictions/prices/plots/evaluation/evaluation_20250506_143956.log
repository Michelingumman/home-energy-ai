2025-05-06 14:39:56,589 - INFO - Starting merged model evaluation (trend + valley)...
2025-05-06 14:39:56,590 - INFO - Loading data...
2025-05-06 14:39:56,681 - INFO - Loaded price data with shape (73007, 11)
2025-05-06 14:39:56,782 - INFO - Loaded grid data with shape (73132, 19)
2025-05-06 14:39:57,080 - INFO - Loaded time features with shape (289296, 10)
2025-05-06 14:39:57,607 - INFO - Loaded holidays data with shape (710017, 4)
2025-05-06 14:39:57,731 - INFO - Loaded weather data with shape (73080, 6)
2025-05-06 14:40:01,055 - INFO - Robust valley detection found 14059 valleys (19.3% of data)
2025-05-06 14:40:01,060 - INFO - Identified 14059 valleys (19.3% of data) using robust valley detection
2025-05-06 14:40:01,060 - INFO - Final merged data shape: (73007, 65)
2025-05-06 14:40:01,064 - INFO - Loading trend model...
2025-05-06 14:40:01,064 - INFO - Searching for trend models...
2025-05-06 14:40:01,064 - INFO - Using best trend model: C:\_Projects\home-energy-ai\src\predictions\prices\models\trend_model\best_trend_model.pkl
2025-05-06 14:40:01,065 - INFO - Loaded parameters for XGBoost model
2025-05-06 14:40:01,554 - INFO - Successfully loaded model from C:\_Projects\home-energy-ai\src\predictions\prices\models\trend_model\best_trend_model.pkl
2025-05-06 14:40:01,555 - INFO - Loaded feature order list with 22 features
2025-05-06 14:40:01,555 - INFO - Model uses 22 features
2025-05-06 14:40:01,555 - INFO - Top features: ['price_24h_avg', 'price_168h_avg', 'is_business_hour', 'hour_avg_price', 'is_morning_peak']
2025-05-06 14:40:01,555 - INFO - Loading valley model...
2025-05-06 14:40:01,555 - INFO - Loading valley detection model...
2025-05-06 14:40:01,556 - INFO - Using model from best_valley_model.keras
2025-05-06 14:40:02,721 - WARNING - From C:\Users\adamm\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\keras\src\backend\tensorflow\core.py:216: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

2025-05-06 14:40:02,907 - INFO - Loaded valley model from C:\_Projects\home-energy-ai\src\predictions\prices\models\valley_model\best_valley_model.keras
2025-05-06 14:40:02,907 - INFO - Loaded feature list with 27 features
2025-05-06 14:40:02,908 - INFO - Loaded feature scaler from C:\_Projects\home-energy-ai\src\predictions\prices\models\valley_model\feature_scaler_valley_model.save
2025-05-06 14:40:02,908 - INFO - Starting combined trend and valley model evaluation...
2025-05-06 14:40:02,940 - INFO - Using test data with 14601 rows from 2023-08-31 15:00:00+00:00 to 2025-04-30 23:00:00+00:00
2025-05-06 14:40:02,940 - INFO - Adding specialized features for valley detection...
2025-05-06 14:40:02,955 - WARNING - No feature names found in trend artifacts, trying to load from file
2025-05-06 14:40:02,955 - INFO - Loaded 22 feature names from file
2025-05-06 14:40:02,955 - INFO - Making trend predictions...
2025-05-06 14:40:02,955 - INFO - Adding time features for trend model...
2025-05-06 14:40:02,973 - INFO - Making predictions with trend model using 22 features...
2025-05-06 14:40:02,977 - ERROR - Error making trend predictions: training data did not have the following fields: price_24h_avg, dayofweek_cos, powerExportTotal, day_cos, hour_avg_price, month_cos, hour_cos, is_evening_peak, powerConsumptionTotal, wind, powerImportTotal, powerProductionTotal, day_sin, is_weekend, is_business_hour, hour_sin, dayofweek_sin, nuclear, month_sin, is_morning_peak, hydro, price_168h_avg
2025-05-06 14:40:02,977 - WARNING - Using actual prices as fallback for trend predictions
2025-05-06 14:40:02,978 - INFO - Making valley predictions with threshold 0.6...
2025-05-06 14:40:07,085 - INFO - Truncating trend predictions to match valley predictions: 14601 -> 14410
2025-05-06 14:40:07,086 - WARNING - Length mismatch between actual_valleys (14433) and valley_predictions (14410)
2025-05-06 14:40:07,086 - INFO - Truncated arrays to common length: 14410
2025-05-06 14:40:07,086 - INFO - Generating visualizations for 4 weeks...
2025-05-06 14:40:08,094 - INFO - Generated visualization for week starting 2023-09-07
2025-05-06 14:40:09,136 - INFO - Generated visualization for week starting 2023-09-14
2025-05-06 14:40:10,000 - INFO - Generated visualization for week starting 2023-09-21
2025-05-06 14:40:10,895 - INFO - Generated visualization for week starting 2023-09-28
2025-05-06 14:40:10,919 - INFO - Merged model evaluation complete.
